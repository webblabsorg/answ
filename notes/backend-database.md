

**File Glob Results:**

- **C:\Users\Plange\Downloads\Projects\answly\README.md**
- **C:\Users\Plange\Downloads\Projects\answly\dev\README.md**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\.dockerignore**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\.env.example**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\.npmrc**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\Dockerfile.dev**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\README.md**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\nest-cli.json**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\npx**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\package-lock.json**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\package.json**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\prisma\schema.prisma**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\prisma\schema.prisma.backup**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\prisma\seed.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\scripts\test-generation.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\admin\admin-csv.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\admin\admin.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\admin\admin.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\admin\admin.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\admin\dto\bulk-import.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\admin\dto\grade-essay.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\admin\dto\update-user-role.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\ai.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\controllers\ai-admin.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\controllers\generation.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\controllers\irt.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\controllers\tutor.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\guards\rate-limit.guard.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\interfaces\ai-provider.interface.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\processors\question-generation.processor.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\providers\anthropic.provider.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\providers\cohere.provider.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\providers\openai.provider.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\ai-orchestrator.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\ai-tutor.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\ai-usage-tracking.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\content-validator.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\irt.service.spec.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\irt.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\personalization.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\prompt-template.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\question-generator.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\rag.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\response-cache.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\translation.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\ai\services\vector-store.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\app.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\audit-logs\audit-logs.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\audit-logs\audit-logs.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\audit-logs\audit-logs.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\auth.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\auth.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\auth.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\decorators\current-user.decorator.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\decorators\public.decorator.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\decorators\roles.decorator.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\dto\login.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\dto\register.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\guards\jwt-auth.guard.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\guards\roles.guard.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\auth\strategies\jwt.strategy.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\billing.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\controllers\analytics.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\controllers\predictions.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\controllers\revenue.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\controllers\subscription.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\controllers\usage.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\controllers\webhook.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\dto\change-tier.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\dto\create-checkout.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\dto\create-portal-session.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\dto\index.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\guards\quota.guard.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\analytics.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\currency.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\dunning.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\paypal.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\prediction.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\regional-payment.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\stripe.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\subscription.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\tax.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\billing\services\usage-tracking.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\cache\cache.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\cache\cache.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\compliance.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\controllers\api-key.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\controllers\audit-log.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\controllers\compliance.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\guards\api-key.guard.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\guards\permission.guard.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\services\api-key.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\services\audit-log.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\services\compliance.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\services\integrity.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\compliance\services\permission.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\controllers\invite.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\controllers\organization.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\controllers\sso.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\controllers\team.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\enterprise.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\guards\organization.guard.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\services\invite.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\services\organization.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\services\sso.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\enterprise\services\team.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\exams\dto\create-exam.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\exams\dto\update-exam.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\exams\exams.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\exams\exams.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\exams\exams.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\grading\grading.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\grading\grading.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\main.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\prisma\prisma.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\prisma\prisma.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\questions\dto\create-question.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\questions\dto\update-question.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\questions\questions.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\questions\questions.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\questions\questions.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\test-sessions\dto\create-test-session.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\test-sessions\dto\submit-answer.dto.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\test-sessions\test-sessions.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\test-sessions\test-sessions.gateway.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\test-sessions\test-sessions.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\test-sessions\test-sessions.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\users\users.controller.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\users\users.module.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\users\users.service.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\test\README.md**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\test\e2e\auth.e2e-spec.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\test\e2e\exams.e2e-spec.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\test\load-test.js**
- **C:\Users\Plange\Downloads\Projects\answly\dev\backend\tsconfig.json**
- **C:\Users\Plange\Downloads\Projects\answly\dev\docker-compose.yml**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\.env.example**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\README.md**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\next.config.mjs**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\package-lock.json**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\package.json**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\public\icons\README.md**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\components\auth\index.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\components\chat\index.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\components\home\index.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\components\layout\index.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\hooks\useKeyboardShortcuts.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\hooks\useTestSession.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\lib\api-client.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\lib\auth\microsoft.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\lib\utils.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\lib\web-vitals.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\store\auth-store.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\store\currency-store.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\src\store\locale-store.ts**
- **C:\Users\Plange\Downloads\Projects\answly\dev\frontend\tsconfig.json**
- **C:\Users\Plange\Downloads\Projects\answly\notes\README.md**
- **C:\Users\Plange\Downloads\Projects\answly\notes\phases\README.md**




**Files Read:**

**C:\Users\Plange\Downloads\Projects\answly\README.md**
```
# Answly - AI-Powered Exam Preparation Platform

A comprehensive exam preparation platform powered by advanced AI for standardized tests (GRE, SAT, GMAT, TOEFL, IELTS).

## Features

### Phase 1: Core Platform ✅
- User authentication and authorization
- Exam session management
- Question bank with multiple formats
- Exam simulation interface
- Real-time scoring and analytics
- Essay grading with AI feedback
- Admin dashboard
- PWA support (offline access)

### Phase 2: AI Integration ✅
- **AI Infrastructure** - Multiple providers (OpenAI, Anthropic, Cohere)
- **Question Generation** - Automated question creation with 5-check validation
- **AI Tutor** - Conversational study assistant with RAG
- **Response Caching** - 70% cost savings
- **Multi-Language** - 9 languages supported
- **Voice I/O** - Speech-to-text and text-to-speech
- **Rate Limiting** - Abuse prevention

## Tech Stack

### Backend
- NestJS + TypeScript
- PostgreSQL + Prisma
- Redis (caching & queues)
- BullMQ (async jobs)
- LangChain (RAG)
- OpenAI/Anthropic/Cohere APIs

### Frontend
- Next.js 14 (App Router)
- React + TypeScript
- Tailwind CSS + shadcn/ui
- React Query
- PWA support

## Quick Start

### Prerequisites
- Node.js 18+
- PostgreSQL 14+
- Redis 7+
- Docker (optional)

### Installation

```bash
# Clone repository
git clone https://github.com/webblabsorg/answ.git
cd answ

# Start infrastructure
docker-compose up -d postgres redis

# Backend setup
cd dev/backend
npm install
npx prisma migrate dev
npm run start:dev

# Frontend setup (new terminal)
cd dev/frontend
npm install
npm run dev
```

### Environment Variables

See `.env.example` files in `dev/backend` and `dev/frontend` directories.

Required API keys:
- `OPENAI_API_KEY` - For AI features
- `DATABASE_URL` - PostgreSQL connection
- `REDIS_HOST` - Redis connection

## Documentation

Comprehensive documentation available in `/notes`:

- **PHASE2-COMPLETE-SUMMARY.md** - Complete Phase 2 overview
- **PRODUCTION-DEPLOYMENT-GUIDE.md** - Production deployment guide
- **PHASE2-SESSION*-COMPLETE.md** - Detailed session documentation
- **PHASE2-IMPLEMENTATION-GUIDE.md** - Full implementation roadmap

## Features by Session

### Session 7: AI Infrastructure
- 3 AI providers with intelligent routing
- Cost tracking and analytics
- Prompt template system
- Vector store integration

### Session 8: Question Generation
- Automated question generation (100 questions in 3 minutes)
- 5-check validation pipeline
- Review queue UI
- Cost: $0.022 per question

### Session 9: AI Tutor & RAG
- Conversational AI tutor
- RAG for context-aware responses
- Question explanations
- Study tips generation
- Voice input/output
- Multi-language (9 languages)
- Response caching (70% cost savings)

## API Endpoints

- **25 AI-powered endpoints**
- **6 Tutor endpoints**
- **10 Generation endpoints**
- **7 Admin endpoints**

## Performance

- Question generation: ~3 minutes per 100 questions
- AI Tutor response: 3-4s (uncached), 0.3-0.5s (cached)
- RAG retrieval: <1s
- Cache hit rate: 60-70%

## Cost Efficiency

- Question generation: $0.022 per question
- AI Tutor conversation: $0.015-0.024 (with caching)
- Cache savings: 70% reduction
- Monthly cost (1,000 users): ~$345-580

## Production Ready

- ✅ Docker configurations
- ✅ Environment variable templates
- ✅ Database migrations
- ✅ Monitoring setup (Sentry)
- ✅ Security measures
- ✅ Backup procedures
- ✅ Load balancing ready
- ✅ Horizontal scaling support

## License

Proprietary - All rights reserved

## Contact

For questions or support, contact: [Your contact info]

---

**Version:** Phase 2 Complete  
**Status:** Production Ready  
**Last Updated:** November 9, 2025

```

**C:\Users\Plange\Downloads\Projects\answly\dev\README.md**
```
# Answly Development

This directory contains the source code for the Answly platform.

## Project Structure

```
dev/
├── frontend/          # Next.js 14 application
├── backend/           # NestJS API
├── shared/            # Shared types and utilities
└── docker-compose.yml # Local development environment
```

## Prerequisites

- Node.js 18+
- PostgreSQL 15+
- Redis 7+
- Docker (recommended for local development)

## Quick Start

### Using Docker (Recommended)

```bash
# Start all services
docker-compose up -d

# Wait for services to start (first time: 5-10 minutes)

# Seed the database (after backend is ready)
docker exec answly-backend npx prisma db seed

# Access the application:
# - Frontend: http://localhost:3000
# - Backend API: http://localhost:4000
# - API Docs: http://localhost:4000/api
```

### Manual Setup

#### Backend

```bash
cd backend
npm install
cp .env.example .env
# Configure DATABASE_URL, JWT_SECRET, etc. in .env
npx prisma generate
npx prisma migrate dev
npx prisma db seed          # Load 3 exams with sample questions
npm run start:dev
```

#### Frontend

```bash
cd frontend
npm install
cp .env.example .env.local
# Configure NEXT_PUBLIC_API_URL in .env.local
npm run dev
```

## Development

- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:4000
- **API Docs**: http://localhost:4000/api
- **PostgreSQL**: localhost:5432
- **Redis**: localhost:6379

## Testing

```bash
# Backend tests
cd backend
npm test
npm run test:e2e

# Frontend tests
cd frontend
npm test
npm run test:e2e
```

## Documentation

See `/notes` directory for complete technical specifications and implementation guides.

## Current Phase

**Phase 1: Foundation** - Session 4: Test-Taking UI Part 2 ✅

### Completed Sessions
- ✅ **Session 1:** Infrastructure & Auth ([Details](../notes/SESSION-1-COMPLETE.md))
- ✅ **Session 2:** Exam Catalog & Data Models ([Details](../notes/SESSION-2-COMPLETE.md))
- ✅ **Session 3:** Test-Taking UI - Part 1 ([Details](../notes/SESSION-3-COMPLETE.md))
- ✅ **Session 4:** Test-Taking UI - Part 2 ([Details](../notes/SESSION-4-COMPLETE.md))

### What's Working Now
- User authentication (register, login, JWT)
- Exam catalog with 3 exams (GRE, SAT, GMAT)
- **Full test-taking interface with timer**
- **6 question types supported (MCQ, Multiple Select, Numeric, Text, Essay, True/False)**
- **Auto-grading system (5 question types)**
- **Complete results dashboard with analytics**
- **Section breakdown and topic performance**
- **Question-by-question review with explanations**
- Real-time answer auto-save
- Question navigation with visual status
- WebSocket integration
- Question bank with 11+ sample questions
- Search and filtering
- RESTful API with Swagger docs (29 endpoints)

### Next Up
- **Session 5:** Admin Panel (Weeks 9-10)
- Focus: Content management, bulk import, user management, essay review queue

See [Phase 1 Implementation Guide](../notes/implementation/01-phase1-foundation.md) for full roadmap.

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\README.md**
```
# Answly Backend

NestJS API with PostgreSQL, Prisma ORM, and JWT authentication.

## Features Implemented

### Phase 1, Session 1 ✅
- ✅ NestJS 10 with TypeScript
- ✅ PostgreSQL + Prisma ORM
- ✅ JWT Authentication
- ✅ User registration & login
- ✅ Password hashing (bcrypt)
- ✅ Auth guards & strategies
- ✅ Swagger API documentation
- ✅ Global validation pipes
- ✅ CORS configuration

## Project Structure

```
src/
├── auth/                 # Authentication module
│   ├── dto/             # Data transfer objects
│   ├── guards/          # Auth guards
│   ├── strategies/      # Passport strategies
│   ├── auth.service.ts  # Auth business logic
│   └── auth.controller.ts
├── users/               # Users module
│   ├── users.service.ts
│   └── users.controller.ts
├── prisma/              # Database module
│   ├── prisma.service.ts
│   └── prisma.module.ts
├── app.module.ts        # Root module
└── main.ts              # Entry point

prisma/
└── schema.prisma        # Database schema
```

## Database Schema

Current models:
- ✅ User (authentication)
- ✅ Exam (exam catalog)
- ✅ ExamSection
- ✅ Question (question bank)
- ✅ TestSession (test attempts)
- ✅ Attempt (answer tracking)
- ✅ Bookmark (saved questions)
- ✅ QuestionNote (user notes)

## API Endpoints

### Authentication
- `POST /auth/register` - Register new user
- `POST /auth/login` - Login with email/password
- `GET /auth/me` - Get current user (protected)

### Users
- `GET /users/:id` - Get user by ID (protected)

### API Documentation
- `GET /api` - Swagger UI (when server is running)

## Available Scripts

```bash
# Development
npm run start:dev        # Start with hot-reload

# Build
npm run build            # Production build
npm run start:prod       # Start production server

# Database
npx prisma generate      # Generate Prisma Client
npx prisma migrate dev   # Run migrations
npx prisma studio        # Open Prisma Studio
npx prisma db seed       # Seed database

# Testing
npm test                 # Unit tests
npm run test:e2e         # E2E tests
npm run test:cov         # Test coverage
```

## Environment Variables

Create `.env`:

```env
DATABASE_URL="postgresql://answly:password@localhost:5432/answly_dev"
REDIS_URL="redis://localhost:6379"
JWT_SECRET="your-secret-key-here"
JWT_EXPIRATION="7d"
PORT=4000
CORS_ORIGIN="http://localhost:3000"
```

## Tech Stack

- **Framework**: NestJS 10
- **Language**: TypeScript
- **Database**: PostgreSQL 15
- **ORM**: Prisma
- **Authentication**: JWT (Passport.js)
- **Validation**: class-validator
- **Documentation**: Swagger/OpenAPI

## Next Steps

Session 2 will add:
- Exam CRUD endpoints
- Question management
- Question search & filtering
- CSV/JSON import service

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\package.json**
```
{
  "name": "answly-backend",
  "version": "1.0.0",
  "description": "Answly Backend API - NestJS",
  "author": "Answly Team",
  "private": true,
  "license": "UNLICENSED",
  "scripts": {
    "build": "nest build",
    "format": "prettier --write \"src/**/*.ts\" \"test/**/*.ts\"",
    "start": "nest start",
    "start:dev": "nest start --watch",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main",
    "lint": "eslint \"{src,apps,libs,test}/**/*.ts\" --fix",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:cov": "jest --coverage",
    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand",
    "test:e2e": "jest --config ./test/jest-e2e.json",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio",
    "prisma:seed": "ts-node prisma/seed.ts"
  },
  "dependencies": {
    "@anthropic-ai/sdk": "^0.68.0",
    "@langchain/anthropic": "^1.0.0",
    "@langchain/community": "^1.0.0",
    "@langchain/core": "^1.0.3",
    "@langchain/openai": "^1.0.0",
    "@nestjs/bullmq": "^11.0.4",
    "@nestjs/common": "^10.3.0",
    "@nestjs/config": "^3.1.1",
    "@nestjs/core": "^10.3.0",
    "@nestjs/jwt": "^10.2.0",
    "@nestjs/passport": "^10.0.3",
    "@nestjs/platform-express": "^10.3.0",
    "@nestjs/platform-socket.io": "^10.3.0",
    "@nestjs/schedule": "^3.0.4",
    "@nestjs/swagger": "^7.2.0",
    "@nestjs/throttler": "^6.4.0",
    "@nestjs/websockets": "^10.3.0",
    "@pinecone-database/pinecone": "^6.1.3",
    "@prisma/client": "^5.8.0",
    "@types/multer": "^2.0.0",
    "@types/papaparse": "^5.5.0",
    "axios": "^1.6.5",
    "bcrypt": "^5.1.1",
    "bullmq": "^5.63.0",
    "class-transformer": "^0.5.1",
    "class-validator": "^0.14.1",
    "cohere-ai": "^7.19.0",
    "compression": "^1.8.1",
    "helmet": "^8.1.0",
    "ioredis": "^5.8.2",
    "langchain": "^1.0.3",
    "multer": "^2.0.2",
    "openai": "^6.8.1",
    "papaparse": "^5.5.3",
    "passport": "^0.7.0",
    "passport-jwt": "^4.0.1",
    "reflect-metadata": "^0.1.14",
    "rxjs": "^7.8.1",
    "socket.io": "^4.7.2",
    "stripe": "^19.3.0"
  },
  "devDependencies": {
    "@nestjs/cli": "^10.3.0",
    "@nestjs/schematics": "^10.1.0",
    "@nestjs/testing": "^10.3.0",
    "@types/bcrypt": "^5.0.2",
    "@types/express": "^4.17.21",
    "@types/jest": "^29.5.11",
    "@types/node": "^20.10.6",
    "@types/passport-jwt": "^4.0.0",
    "@typescript-eslint/eslint-plugin": "^6.18.1",
    "@typescript-eslint/parser": "^6.18.1",
    "eslint": "^8.56.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-prettier": "^5.1.3",
    "jest": "^29.7.0",
    "prettier": "^3.1.1",
    "prisma": "^5.8.0",
    "source-map-support": "^0.5.21",
    "ts-jest": "^29.1.1",
    "ts-loader": "^9.5.1",
    "ts-node": "^10.9.2",
    "tsconfig-paths": "^4.2.0",
    "typescript": "^5.3.3",
    "webpack": "^5.102.1"
  },
  "jest": {
    "moduleFileExtensions": [
      "js",
      "json",
      "ts"
    ],
    "rootDir": "src",
    "testRegex": ".*\\.spec\\.ts$",
    "transform": {
      "^.+\\.(t|j)s$": "ts-jest"
    },
    "collectCoverageFrom": [
      "**/*.(t|j)s"
    ],
    "coverageDirectory": "../coverage",
    "testEnvironment": "node"
  }
}

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\prisma\schema.prisma**
```
// Answly Database Schema
// Phase 1: Foundation Models
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// User Management
// ============================================================================
enum UserRole {
  TEST_TAKER
  INSTRUCTOR
  REVIEWER
  ADMIN
  SUPPORT
}

enum SubscriptionTier {
  STARTER
  GROW
  SCALE
  ENTERPRISE
}

enum OrganizationRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

enum InviteStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
}

enum SSOProvider {
  SAML
  GOOGLE
  MICROSOFT
  OKTA
  AUTH0
  CUSTOM
}

enum SSOStatus {
  ACTIVE
  INACTIVE
  PENDING_SETUP
}

model User {
  id                 String              @id @default(cuid())
  email              String              @unique
  password_hash      String
  name               String
  role               UserRole            @default(TEST_TAKER)
  tier               SubscriptionTier    @default(STARTER)
  stripe_customer_id String?             @unique
  organization_role  OrganizationRole?
  organization_id    String?
  is_verified        Boolean             @default(false)
  is_active          Boolean             @default(true)
  created_at         DateTime            @default(now())
  updated_at         DateTime            @updatedAt
  last_login_at      DateTime?
  // Relations
  organization       Organization?       @relation("OrganizationMembers", fields: [organization_id], references: [id], onDelete: SetNull)
  organization_owned Organization?       @relation("OrganizationOwner")
  team_memberships   TeamMember[]
  test_sessions      TestSession[]
  attempts           Attempt[]
  bookmarks          Bookmark[]
  notes              QuestionNote[]
  audit_logs         AuditLog[]
  generation_jobs    GenerationJob[]     @relation("CreatedJobs")
  reviewed_questions GeneratedQuestion[] @relation("ReviewedQuestions")
  conversations      Conversation[]
  irt_profiles       IRTProfile[]
  subscriptions      Subscription[]
  usage_records      UsageRecord[]
  sent_invites       Invite[]            @relation("InviteSender")
  sso_logins         SSOLogin[]
  dunning_attempts   DunningAttempt[]
  // Compliance & API
  created_api_keys   APIKey[]           @relation("CreatedAPIKeys")
  user_permissions   UserPermission[]   @relation("UserPermissions")
  granted_permissions UserPermission[]  @relation("GrantedPermissions")
  integrity_events   IntegrityEvent[]   @relation("IntegrityEvents")
  data_export_requests DataExportRequest[] @relation("DataExportRequests")

  @@index([email])
  @@index([role, tier])
  @@index([stripe_customer_id])
  @@index([organization_id])
  @@map("users")
}

// ============================================================================
// Exam Catalog
// ============================================================================
enum ExamCategory {
  STANDARDIZED_TEST
  PROFESSIONAL_CERT
  LANGUAGE_TEST
  REGIONAL_EXAM
}

model Exam {
  id               String          @id @default(cuid())
  name             String
  code             String          @unique
  category         ExamCategory
  description      String?         @db.Text
  duration_minutes Int
  total_sections   Int
  total_questions  Int
  passing_score    Int?
  is_active        Boolean         @default(true)
  created_at       DateTime        @default(now())
  updated_at       DateTime        @updatedAt
  // Relations
  sections         ExamSection[]
  questions        Question[]
  test_sessions    TestSession[]
  generation_jobs  GenerationJob[]
  conversations    Conversation[]
  irt_profiles     IRTProfile[]

  @@index([code])
  @@index([category, is_active])
  @@map("exams")
}

model ExamSection {
  id               String     @id @default(cuid())
  exam_id          String
  name             String
  section_order    Int
  duration_minutes Int
  question_count   Int
  description      String?    @db.Text
  created_at       DateTime   @default(now())
  // Relations
  exam             Exam       @relation(fields: [exam_id], references: [id], onDelete: Cascade)
  questions        Question[]

  @@unique([exam_id, section_order])
  @@index([exam_id])
  @@map("exam_sections")
}

// ============================================================================
// Question Bank
// ============================================================================
enum QuestionType {
  MULTIPLE_CHOICE
  MULTIPLE_SELECT
  NUMERIC_INPUT
  TEXT_INPUT
  ESSAY
  TRUE_FALSE
}

model Question {
  id                    String             @id @default(cuid())
  exam_id               String
  section_id            String?
  question_text         String             @db.Text
  question_type         QuestionType
  options               Json? // Array of {id, text, correct}
  correct_answer        Json // Flexible structure based on type
  difficulty_level      Int                @default(3) // 1-5 scale
  topic                 String
  subtopic              String?
  skills                String[] // e.g., ["algebra", "problem-solving"]
  explanation           String?            @db.Text
  explanation_video_url String?
  time_estimate_seconds Int                @default(90)
  is_active             Boolean            @default(true)
  // AI generation metadata
  ai_generated          Boolean            @default(false)
  generated_question_id String?            @unique
  quality_score         Float?
  // IRT parameters
  irt_a                 Float?
  irt_b                 Float?
  irt_c                 Float?
  calibration_sample    Int?
  last_calibrated_at    DateTime?
  created_at            DateTime           @default(now())
  updated_at            DateTime           @updatedAt
  // Relations
  exam                  Exam               @relation(fields: [exam_id], references: [id], onDelete: Cascade)
  section               ExamSection?       @relation(fields: [section_id], references: [id], onDelete: SetNull)
  generated_from        GeneratedQuestion? @relation("GeneratedFrom", fields: [generated_question_id], references: [id], onDelete: SetNull)
  attempts              Attempt[]
  bookmarks             Bookmark[]
  notes                 QuestionNote[]

  @@index([exam_id, topic])
  @@index([exam_id, section_id])
  @@index([difficulty_level])
  @@index([is_active])
  @@index([question_type])
  @@index([created_at])
  @@index([ai_generated])
  @@index([irt_b])
  @@map("questions")
}

// ============================================================================
// Test Sessions
// ============================================================================
enum TestSessionStatus {
  NOT_STARTED
  IN_PROGRESS
  PAUSED
  COMPLETED
  GRADED
  ABANDONED
}

model TestSession {
  id               String            @id @default(cuid())
  user_id          String
  exam_id          String
  status           TestSessionStatus @default(NOT_STARTED)
  started_at       DateTime?
  completed_at     DateTime?
  submitted_at     DateTime?
  duration_seconds Int?
  // Scoring
  total_questions  Int
  total_attempted  Int               @default(0)
  total_correct    Int?
  raw_score        Float?
  scaled_score     Float?
  percentile       Float?
  // Configuration
  is_practice_mode Boolean           @default(false)
  is_adaptive      Boolean           @default(false)
  created_at       DateTime          @default(now())
  updated_at       DateTime          @updatedAt
  // Relations
  user             User              @relation(fields: [user_id], references: [id], onDelete: Cascade)
  exam             Exam              @relation(fields: [exam_id], references: [id], onDelete: Cascade)
  attempts         Attempt[]

  @@index([user_id, status])
  @@index([user_id, created_at])
  @@index([exam_id, created_at])
  @@index([status])
  @@index([completed_at])
  @@map("test_sessions")
}

model Attempt {
  id                 String      @id @default(cuid())
  session_id         String
  user_id            String
  question_id        String
  user_answer        Json? // Flexible structure based on question type
  is_correct         Boolean?
  time_spent_seconds Int?
  is_flagged         Boolean     @default(false)
  created_at         DateTime    @default(now())
  updated_at         DateTime    @updatedAt
  // Relations
  session            TestSession @relation(fields: [session_id], references: [id], onDelete: Cascade)
  user               User        @relation(fields: [user_id], references: [id], onDelete: Cascade)
  question           Question    @relation(fields: [question_id], references: [id], onDelete: Cascade)

  @@unique([session_id, question_id])
  @@index([user_id])
  @@index([session_id])
  @@index([question_id])
  @@index([is_correct])
  @@map("attempts")
}

// ============================================================================
// User Features
// ============================================================================
model Bookmark {
  id          String   @id @default(cuid())
  user_id     String
  question_id String
  created_at  DateTime @default(now())
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  question    Question @relation(fields: [question_id], references: [id], onDelete: Cascade)

  @@unique([user_id, question_id])
  @@index([user_id])
  @@map("bookmarks")
}

model QuestionNote {
  id          String   @id @default(cuid())
  user_id     String
  question_id String
  note_text   String   @db.Text
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  question    Question @relation(fields: [question_id], references: [id], onDelete: Cascade)

  @@unique([user_id, question_id])
  @@index([user_id])
  @@map("question_notes")
}

// ============================================================================
// Audit Logs
// ============================================================================
model AuditLog {
  id          String   @id @default(cuid())
  user_id     String
  action      String
  entity_type String
  entity_id   String?
  changes     Json?
  ip_address  String?
  user_agent  String?
  created_at  DateTime @default(now())
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([entity_type, entity_id])
  @@index([created_at])
  @@map("audit_logs")
}

// ============================================================================
// AI & Machine Learning (Phase 2)
// ============================================================================
model AIUsageLog {
  id            String   @id @default(cuid())
  provider      String
  task_type     String
  model         String?
  tokens_used   Int
  cost          Float
  latency_ms    Int
  success       Boolean
  is_fallback   Boolean  @default(false)
  error_message String?
  created_at    DateTime @default(now())

  @@index([provider])
  @@index([task_type])
  @@index([created_at])
  @@map("ai_usage_logs")
}

model PromptTemplate {
  id          String   @id @default(cuid())
  name        String
  version     String
  content     String   @db.Text
  description String?
  task_type   String
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@unique([name, version])
  @@index([name, is_active])
  @@map("prompt_templates")
}

enum GenerationJobStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

model GenerationJob {
  id                  String              @id @default(cuid())
  exam_id             String
  topic               String
  subtopic            String?
  difficulty          Int
  count               Int
  status              GenerationJobStatus @default(PENDING)
  progress            Float               @default(0)
  generated_count     Int                 @default(0)
  failed_count        Int                 @default(0)
  total_cost          Float               @default(0)
  error_message       String?
  started_at          DateTime?
  completed_at        DateTime?
  created_at          DateTime            @default(now())
  created_by_id       String
  exam                Exam                @relation(fields: [exam_id], references: [id], onDelete: Cascade)
  created_by          User                @relation(name: "CreatedJobs", fields: [created_by_id], references: [id])
  generated_questions GeneratedQuestion[]

  @@index([status])
  @@index([exam_id])
  @@index([created_at])
  @@map("generation_jobs")
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
  NEEDS_REVISION
}

model GeneratedQuestion {
  id                  String        @id @default(cuid())
  generation_job_id   String
  question_text       String        @db.Text
  question_type       QuestionType
  options             Json?
  correct_answer      Json
  explanation         String?       @db.Text
  topic               String
  subtopic            String?
  difficulty_level    Int           @default(3)
  quality_score       Float?
  validation_errors   String[]
  validation_warnings String[]
  status              ReviewStatus  @default(PENDING)
  ai_provider         String
  ai_model            String
  prompt_template_id  String?
  generation_cost     Float
  reviewed_by_id      String?
  review_notes        String?
  approved_at         DateTime?
  created_at          DateTime      @default(now())
  generation_job      GenerationJob @relation(fields: [generation_job_id], references: [id], onDelete: Cascade)
  reviewed_by         User?         @relation(name: "ReviewedQuestions", fields: [reviewed_by_id], references: [id], onDelete: SetNull)
  approved_question   Question?     @relation("GeneratedFrom")

  @@index([generation_job_id])
  @@index([status])
  @@index([quality_score])
  @@index([created_at])
  @@map("generated_questions")
}

model Conversation {
  id         String                @id @default(cuid())
  user_id    String
  exam_id    String?
  title      String?
  created_at DateTime              @default(now())
  updated_at DateTime              @updatedAt
  user       User                  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  exam       Exam?                 @relation(fields: [exam_id], references: [id], onDelete: SetNull)
  messages   ConversationMessage[]

  @@index([user_id])
  @@index([created_at])
  @@map("conversations")
}

model ConversationMessage {
  id              String       @id @default(cuid())
  conversation_id String
  role            String
  content         String       @db.Text
  sources         Json?
  tokens_used     Int?
  cost            Float?
  created_at      DateTime     @default(now())
  conversation    Conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)

  @@index([conversation_id])
  @@index([created_at])
  @@map("conversation_messages")
}

model IRTProfile {
  id               String   @id @default(cuid())
  user_id          String
  exam_id          String
  ability_estimate Float
  standard_error   Float
  attempts_count   Int      @default(0)
  last_updated     DateTime @updatedAt
  created_at       DateTime @default(now())
  user             User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  exam             Exam     @relation(fields: [exam_id], references: [id], onDelete: Cascade)

  @@unique([user_id, exam_id])
  @@index([user_id])
  @@index([exam_id])
  @@map("irt_profiles")
}

// ============================================================================
// Billing & Subscriptions (Phase 3)
// ============================================================================
enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  UNPAID
  TRIALING
  INCOMPLETE
  INCOMPLETE_EXPIRED
}

model Subscription {
  id                     String             @id @default(cuid())
  user_id                String
  tier                   SubscriptionTier
  status                 SubscriptionStatus
  stripe_subscription_id String             @unique
  stripe_price_id        String
  stripe_customer_id     String
  current_period_start   DateTime
  current_period_end     DateTime
  cancel_at_period_end   Boolean            @default(false)
  canceled_at            DateTime?
  trial_start            DateTime?
  trial_end              DateTime?
  created_at             DateTime           @default(now())
  updated_at             DateTime           @updatedAt
  user                   User               @relation(fields: [user_id], references: [id], onDelete: Cascade)
  dunning_attempts       DunningAttempt[]

  @@index([user_id])
  @@index([status])
  @@index([stripe_subscription_id])
  @@map("subscriptions")
}

model UsageRecord {
  id           String   @id @default(cuid())
  user_id      String
  feature_type String // 'test', 'ai_tutor', 'question_generation', etc.
  count        Int      @default(1)
  period_start DateTime
  period_end   DateTime
  created_at   DateTime @default(now())
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id, period_start])
  @@index([feature_type])
  @@map("usage_records")
}

model Invoice {
  id                    String   @id @default(cuid())
  stripe_invoice_id     String   @unique
  stripe_customer_id    String
  stripe_subscription_id String?
  amount_due            Int // in cents
  amount_paid           Int // in cents
  currency              String   @default("usd")
  status                String
  invoice_pdf           String?
  hosted_invoice_url    String?
  period_start          DateTime
  period_end            DateTime
  created_at            DateTime @default(now())
  paid_at               DateTime?

  @@index([stripe_customer_id])
  @@index([status])
  @@index([created_at])
  @@map("invoices")
}
// Add to end of schema.prisma after Invoice model

// ============================================================================
// Phase 4: Enterprise Features - Organizations & Teams
// ============================================================================

model Organization {
  id                 String            @id @default(cuid())
  name               String
  slug               String            @unique
  owner_id           String            @unique
  domain             String?           @unique
  logo_url           String?
  billing_email      String?
  // Billing & Tax
  vat_id             String?           // VAT/Tax ID
  tax_exempt         Boolean           @default(false)
  billing_country    String?           // ISO country code
  billing_address    String?
  billing_city       String?
  billing_postal     String?
  // Settings
  max_seats          Int               @default(10)
  used_seats         Int               @default(0)
  // White-label settings
  custom_domain      String?
  primary_color      String?
  secondary_color    String?
  logo_light_url     String?
  logo_dark_url      String?
  // Feature flags
  sso_enabled        Boolean           @default(false)
  api_access_enabled Boolean           @default(false)
  custom_branding    Boolean           @default(false)
  // Metadata
  is_active          Boolean           @default(true)
  created_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt
  // Relations
  owner              User              @relation("OrganizationOwner", fields: [owner_id], references: [id], onDelete: Cascade)
  members            User[]            @relation("OrganizationMembers")
  teams              Team[]
  invites            Invite[]
  sso_connections    SSOConnection[]
  // Data residency & compliance
  data_region        DataRegion        @default(US_EAST)
  dpa_accepted       Boolean           @default(false)
  dpa_accepted_at    DateTime?
  audit_logs         AuditLog[]
  api_keys           APIKey[]
  user_permissions   UserPermission[]
  immutable_audit_logs ImmutableAuditLog[]

  @@index([slug])
  @@index([owner_id])
  @@index([domain])
  @@map("organizations")
}

model Team {
  id              String       @id @default(cuid())
  organization_id String
  name            String
  description     String?      @db.Text
  is_active       Boolean      @default(true)
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt
  // Relations
  organization    Organization @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  members         TeamMember[]

  @@index([organization_id])
  @@map("teams")
}

model TeamMember {
  id         String           @id @default(cuid())
  team_id    String
  user_id    String
  role       OrganizationRole @default(MEMBER)
  joined_at  DateTime         @default(now())
  // Relations
  team       Team             @relation(fields: [team_id], references: [id], onDelete: Cascade)
  user       User             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([team_id, user_id])
  @@index([team_id])
  @@index([user_id])
  @@map("team_members")
}

model Invite {
  id              String        @id @default(cuid())
  organization_id String
  email           String
  role            OrganizationRole @default(MEMBER)
  token           String        @unique
  invited_by      String
  status          InviteStatus  @default(PENDING)
  expires_at      DateTime
  accepted_at     DateTime?
  created_at      DateTime      @default(now())
  // Relations
  organization    Organization  @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  sender          User          @relation("InviteSender", fields: [invited_by], references: [id], onDelete: Cascade)

  @@index([organization_id])
  @@index([email])
  @@index([token])
  @@index([status])
  @@map("invites")
}
// Add to end of schema.prisma after Invite model

// ============================================================================
// Phase 4: Enterprise Features - SSO & Authentication
// ============================================================================

model SSOConnection {
  id              String      @id @default(cuid())
  organization_id String
  name            String
  provider        SSOProvider
  status          SSOStatus   @default(PENDING_SETUP)
  // SAML Configuration
  saml_entity_id      String?
  saml_sso_url        String?
  saml_certificate    String?   @db.Text
  saml_sign_requests  Boolean   @default(false)
  // OAuth Configuration
  oauth_client_id     String?
  oauth_client_secret String?
  oauth_authorize_url String?
  oauth_token_url     String?
  oauth_userinfo_url  String?
  // Domain Configuration
  domains         String[]    @default([])
  auto_provision  Boolean     @default(false)
  default_role    OrganizationRole @default(MEMBER)
  // Metadata
  metadata        Json?
  is_active       Boolean     @default(true)
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt
  last_used_at    DateTime?
  // Relations
  organization    Organization @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  logins          SSOLogin[]

  @@index([organization_id])
  @@index([provider])
  @@map("sso_connections")
}

model SSOLogin {
  id                String        @id @default(cuid())
  sso_connection_id String
  user_id           String
  nameID            String?
  session_index     String?
  attributes        Json?
  ip_address        String?
  user_agent        String?
  created_at        DateTime      @default(now())
  // Relations
  sso_connection    SSOConnection @relation(fields: [sso_connection_id], references: [id], onDelete: Cascade)
  user              User          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([sso_connection_id])
  @@index([user_id])
  @@index([created_at])
  @@map("sso_logins")
}
enum DunningStatus {
  PENDING
  RECOVERED
  EXHAUSTED
}

// Add new model at end of file
model DunningAttempt {
  id              String        @id @default(cuid())
  user_id         String
  subscription_id String
  invoice_id      String
  attempt_number  Int           @default(1)
  failure_reason  String?
  next_attempt_at DateTime
  last_attempt_at DateTime?
  status          DunningStatus @default(PENDING)
  completed_at    DateTime?
  created_at      DateTime      @default(now())
  // Relations
  user            User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  subscription    Subscription  @relation(fields: [subscription_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([subscription_id])
  @@index([status])
  @@index([next_attempt_at])
  @@map("dunning_attempts")
}
// Add new enums
enum AuditAction {
  USER_LOGIN
  USER_LOGOUT
  USER_CREATE
  USER_UPDATE
  USER_DELETE
  ORG_CREATE
  ORG_UPDATE
  ORG_DELETE
  SUBSCRIPTION_CREATE
  SUBSCRIPTION_UPDATE
  SUBSCRIPTION_CANCEL
  SSO_LOGIN
  SSO_CONFIG_UPDATE
  API_KEY_CREATE
  API_KEY_DELETE
  ROLE_ASSIGN
  PERMISSION_GRANT
  DATA_EXPORT
  DATA_DELETE
  EXAM_START
  EXAM_SUBMIT
  INTEGRITY_VIOLATION
}

enum PermissionScope {
  ORG_ADMIN
  SEAT_ADMIN
  INSTRUCTOR
  REVIEWER
  API_ACCESS
  DATA_EXPORT
  USER_MANAGEMENT
  BILLING_ADMIN
}

enum DataRegion {
  US_EAST
  EU_WEST
  AP_SOUTHEAST
}

// Immutable audit log model
model ImmutableAuditLog {
  id              String      @id @default(cuid())
  organization_id String?
  user_id         String?
  action          AuditAction
  resource_type   String
  resource_id     String?
  changes         Json?       // Before/after data
  metadata        Json?       // IP, user agent, etc.
  hash            String      // SHA-256 hash for integrity
  previous_hash   String?     // Chain to previous log
  timestamp       DateTime    @default(now())
  // Relations
  organization    Organization? @relation(fields: [organization_id], references: [id])
  user            User?         @relation(fields: [user_id], references: [id])

  @@index([organization_id, timestamp])
  @@index([user_id, timestamp])
  @@index([action])
  @@index([timestamp])
  @@map("audit_logs_immutable")
}

// API Key model
model APIKey {
  id              String   @id @default(cuid())
  organization_id String
  name            String
  key_hash        String   @unique
  scopes          String[] // Array of PermissionScope values
  rate_limit      Int      @default(100)  // Requests per minute
  daily_quota     Int      @default(10000)
  is_active       Boolean  @default(true)
  last_used_at    DateTime?
  expires_at      DateTime?
  created_by      String
  created_at      DateTime @default(now())
  // Relations
  organization    Organization @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  creator         User         @relation("CreatedAPIKeys", fields: [created_by], references: [id])
  usage_records   APIKeyUsage[]

  @@index([organization_id])
  @@index([key_hash])
  @@map("api_keys")
}

// API usage tracking
model APIKeyUsage {
  id              String   @id @default(cuid())
  api_key_id      String
  endpoint        String
  method          String
  status_code     Int
  response_time   Int      // milliseconds
  timestamp       DateTime @default(now())
  // Relations
  api_key         APIKey   @relation(fields: [api_key_id], references: [id], onDelete: Cascade)

  @@index([api_key_id, timestamp])
  @@index([timestamp])
  @@map("api_key_usage")
}

// Permission assignment model
model UserPermission {
  id              String          @id @default(cuid())
  user_id         String
  organization_id String
  scope           PermissionScope
  granted_by      String
  granted_at      DateTime        @default(now())
  expires_at      DateTime?
  // Relations
  user            User            @relation("UserPermissions", fields: [user_id], references: [id], onDelete: Cascade)
  organization    Organization    @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  granter         User            @relation("GrantedPermissions", fields: [granted_by], references: [id])

  @@unique([user_id, organization_id, scope])
  @@index([user_id])
  @@index([organization_id])
  @@map("user_permissions")
}

// Exam integrity tracking
model IntegrityEvent {
  id              String   @id @default(cuid())
  test_session_id String
  user_id         String
  event_type      String   // tab_switch, clipboard_access, screenshot_attempt
  severity        String   // low, medium, high
  details         Json?
  timestamp       DateTime @default(now())
  // Relations
  test_session    TestSession @relation(fields: [test_session_id], references: [id], onDelete: Cascade)
  user            User        @relation("IntegrityEvents", fields: [user_id], references: [id])

  @@index([test_session_id])
  @@index([user_id])
  @@index([timestamp])
  @@map("integrity_events")
}

// GDPR data export requests
model DataExportRequest {
  id              String   @id @default(cuid())
  user_id         String
  request_type    String   // export, delete
  status          String   // pending, processing, completed, failed
  download_url    String?
  expires_at      DateTime?
  completed_at    DateTime?
  created_at      DateTime @default(now())
  // Relations
  user            User     @relation("DataExportRequests", fields: [user_id], references: [id])

  @@index([user_id])
  @@index([status])
  @@map("data_export_requests")
}

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\prisma\seed.ts**
```
import { PrismaClient, QuestionType, ExamCategory } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('🌱 Starting database seed...');

  // Create GRE Exam
  const gre = await prisma.exam.upsert({
    where: { code: 'GRE' },
    update: {},
    create: {
      name: 'Graduate Record Examination',
      code: 'GRE',
      category: ExamCategory.STANDARDIZED_TEST,
      description: 'The GRE General Test measures verbal reasoning, quantitative reasoning, critical thinking and analytical writing skills.',
      duration_minutes: 180,
      total_sections: 3,
      total_questions: 80,
      passing_score: 260,
    },
  });

  console.log('✅ Created GRE exam');

  // Create GRE Sections
  const greVerbal = await prisma.examSection.upsert({
    where: { exam_id_section_order: { exam_id: gre.id, section_order: 1 } },
    update: {},
    create: {
      exam_id: gre.id,
      name: 'Verbal Reasoning',
      section_order: 1,
      duration_minutes: 60,
      question_count: 40,
      description: 'Measures ability to analyze and evaluate written material, synthesize information, and understand relationships.',
    },
  });

  const greQuant = await prisma.examSection.upsert({
    where: { exam_id_section_order: { exam_id: gre.id, section_order: 2 } },
    update: {},
    create: {
      exam_id: gre.id,
      name: 'Quantitative Reasoning',
      section_order: 2,
      duration_minutes: 70,
      question_count: 40,
      description: 'Measures problem-solving ability using basic arithmetic, algebra, geometry, and data analysis.',
    },
  });

  console.log('✅ Created GRE sections');

  // Create GRE Verbal Questions
  const greVerbalQuestions = [
    {
      exam_id: gre.id,
      section_id: greVerbal.id,
      question_text: 'Choose the word that best completes the sentence:\nThe speaker was so _____ that many audience members fell asleep during the presentation.',
      question_type: QuestionType.MULTIPLE_CHOICE,
      options: [
        { id: 'A', text: 'eloquent', correct: false },
        { id: 'B', text: 'tedious', correct: true },
        { id: 'C', text: 'captivating', correct: false },
        { id: 'D', text: 'controversial', correct: false },
      ],
      correct_answer: { answer: 'B' },
      difficulty_level: 2,
      topic: 'Vocabulary',
      subtopic: 'Context Clues',
      skills: ['vocabulary', 'reading-comprehension'],
      explanation: 'Tedious means boring or monotonous. The context clue is that audience members fell asleep, indicating the speaker was boring.',
      time_estimate_seconds: 60,
    },
    {
      exam_id: gre.id,
      section_id: greVerbal.id,
      question_text: 'Select all that apply:\nWhich of the following words are synonyms for "ephemeral"?',
      question_type: QuestionType.MULTIPLE_SELECT,
      options: [
        { id: 'A', text: 'fleeting', correct: true },
        { id: 'B', text: 'permanent', correct: false },
        { id: 'C', text: 'transient', correct: true },
        { id: 'D', text: 'enduring', correct: false },
        { id: 'E', text: 'momentary', correct: true },
      ],
      correct_answer: { answers: ['A', 'C', 'E'] },
      difficulty_level: 3,
      topic: 'Vocabulary',
      subtopic: 'Synonyms',
      skills: ['vocabulary', 'word-relationships'],
      explanation: 'Ephemeral means lasting for a very short time. Fleeting, transient, and momentary all share this meaning.',
      time_estimate_seconds: 90,
    },
    {
      exam_id: gre.id,
      section_id: greVerbal.id,
      question_text: 'The author\'s primary purpose in the passage is to:',
      question_type: QuestionType.MULTIPLE_CHOICE,
      options: [
        { id: 'A', text: 'criticize a popular theory', correct: false },
        { id: 'B', text: 'present new research findings', correct: true },
        { id: 'C', text: 'compare two competing viewpoints', correct: false },
        { id: 'D', text: 'defend a controversial position', correct: false },
      ],
      correct_answer: { answer: 'B' },
      difficulty_level: 3,
      topic: 'Reading Comprehension',
      subtopic: 'Author Purpose',
      skills: ['reading-comprehension', 'inference'],
      explanation: 'The passage primarily discusses new research findings and their implications.',
      time_estimate_seconds: 120,
    },
  ];

  // Create GRE Quantitative Questions
  const greQuantQuestions = [
    {
      exam_id: gre.id,
      section_id: greQuant.id,
      question_text: 'If x + 5 = 12, what is the value of 2x?',
      question_type: QuestionType.NUMERIC_INPUT,
      options: null,
      correct_answer: { answer: 14 },
      difficulty_level: 1,
      topic: 'Algebra',
      subtopic: 'Linear Equations',
      skills: ['algebra', 'problem-solving'],
      explanation: 'First solve for x: x + 5 = 12, so x = 7. Then 2x = 2(7) = 14.',
      time_estimate_seconds: 45,
    },
    {
      exam_id: gre.id,
      section_id: greQuant.id,
      question_text: 'Compare Quantity A and Quantity B:\nQuantity A: 3⁴\nQuantity B: 4³',
      question_type: QuestionType.MULTIPLE_CHOICE,
      options: [
        { id: 'A', text: 'Quantity A is greater', correct: false },
        { id: 'B', text: 'Quantity B is greater', correct: true },
        { id: 'C', text: 'The two quantities are equal', correct: false },
        { id: 'D', text: 'The relationship cannot be determined', correct: false },
      ],
      correct_answer: { answer: 'B' },
      difficulty_level: 2,
      topic: 'Arithmetic',
      subtopic: 'Exponents',
      skills: ['arithmetic', 'computation'],
      explanation: '3⁴ = 81 and 4³ = 64, so Quantity A (81) is actually greater than Quantity B (64). Wait, let me recalculate: 3⁴ = 3×3×3×3 = 81, and 4³ = 4×4×4 = 64. So Quantity A is greater.',
      time_estimate_seconds: 60,
    },
    {
      exam_id: gre.id,
      section_id: greQuant.id,
      question_text: 'A rectangle has a length of 10 cm and a width of 6 cm. What is its area in square centimeters?',
      question_type: QuestionType.NUMERIC_INPUT,
      options: null,
      correct_answer: { answer: 60 },
      difficulty_level: 1,
      topic: 'Geometry',
      subtopic: 'Area',
      skills: ['geometry', 'formulas'],
      explanation: 'Area of a rectangle = length × width = 10 × 6 = 60 square centimeters.',
      time_estimate_seconds: 30,
    },
  ];

  // Fix the comparison question
  greQuantQuestions[1].options = [
    { id: 'A', text: 'Quantity A is greater', correct: true },
    { id: 'B', text: 'Quantity B is greater', correct: false },
    { id: 'C', text: 'The two quantities are equal', correct: false },
    { id: 'D', text: 'The relationship cannot be determined', correct: false },
  ];
  greQuantQuestions[1].correct_answer = { answer: 'A' };
  greQuantQuestions[1].explanation = '3⁴ = 81 and 4³ = 64, so Quantity A (81) is greater than Quantity B (64).';

  await prisma.question.createMany({
    data: [...greVerbalQuestions, ...greQuantQuestions],
  });

  console.log(`✅ Created ${greVerbalQuestions.length + greQuantQuestions.length} GRE questions`);

  // Create SAT Exam
  const sat = await prisma.exam.upsert({
    where: { code: 'SAT' },
    update: {},
    create: {
      name: 'Scholastic Assessment Test',
      code: 'SAT',
      category: ExamCategory.STANDARDIZED_TEST,
      description: 'The SAT measures knowledge of reading, writing, and math — things learned in school and needed for success in college.',
      duration_minutes: 180,
      total_sections: 2,
      total_questions: 154,
      passing_score: 1000,
    },
  });

  console.log('✅ Created SAT exam');

  // Create SAT Sections
  const satMath = await prisma.examSection.upsert({
    where: { exam_id_section_order: { exam_id: sat.id, section_order: 1 } },
    update: {},
    create: {
      exam_id: sat.id,
      name: 'Math',
      section_order: 1,
      duration_minutes: 80,
      question_count: 58,
      description: 'Tests algebra, problem solving, data analysis, and advanced math.',
    },
  });

  const satReadingWriting = await prisma.examSection.upsert({
    where: { exam_id_section_order: { exam_id: sat.id, section_order: 2 } },
    update: {},
    create: {
      exam_id: sat.id,
      name: 'Reading and Writing',
      section_order: 2,
      duration_minutes: 100,
      question_count: 96,
      description: 'Tests reading comprehension, vocabulary, and grammar.',
    },
  });

  console.log('✅ Created SAT sections');

  // Create SAT Math Questions
  const satMathQuestions = [
    {
      exam_id: sat.id,
      section_id: satMath.id,
      question_text: 'If 3x + 7 = 22, what is the value of x?',
      question_type: QuestionType.MULTIPLE_CHOICE,
      options: [
        { id: 'A', text: '3', correct: false },
        { id: 'B', text: '5', correct: true },
        { id: 'C', text: '7', correct: false },
        { id: 'D', text: '15', correct: false },
      ],
      correct_answer: { answer: 'B' },
      difficulty_level: 2,
      topic: 'Algebra',
      subtopic: 'Linear Equations',
      skills: ['algebra', 'problem-solving'],
      explanation: 'Subtract 7 from both sides: 3x = 15. Divide by 3: x = 5.',
      time_estimate_seconds: 60,
    },
    {
      exam_id: sat.id,
      section_id: satMath.id,
      question_text: 'What is 15% of 80?',
      question_type: QuestionType.NUMERIC_INPUT,
      options: null,
      correct_answer: { answer: 12 },
      difficulty_level: 1,
      topic: 'Arithmetic',
      subtopic: 'Percentages',
      skills: ['arithmetic', 'percentages'],
      explanation: '15% of 80 = 0.15 × 80 = 12.',
      time_estimate_seconds: 45,
    },
    {
      exam_id: sat.id,
      section_id: satMath.id,
      question_text: 'The equation of a line is y = 2x + 3. What is the slope of this line?',
      question_type: QuestionType.NUMERIC_INPUT,
      options: null,
      correct_answer: { answer: 2 },
      difficulty_level: 2,
      topic: 'Algebra',
      subtopic: 'Linear Functions',
      skills: ['algebra', 'graphs'],
      explanation: 'In the form y = mx + b, m is the slope. Here, m = 2.',
      time_estimate_seconds: 40,
    },
  ];

  await prisma.question.createMany({
    data: satMathQuestions,
  });

  console.log(`✅ Created ${satMathQuestions.length} SAT questions`);

  // Create GMAT Exam
  const gmat = await prisma.exam.upsert({
    where: { code: 'GMAT' },
    update: {},
    create: {
      name: 'Graduate Management Admission Test',
      code: 'GMAT',
      category: ExamCategory.STANDARDIZED_TEST,
      description: 'The GMAT exam measures critical thinking, analytical writing, and problem-solving abilities for business school.',
      duration_minutes: 210,
      total_sections: 4,
      total_questions: 91,
      passing_score: 400,
    },
  });

  console.log('✅ Created GMAT exam');

  // Create GMAT Sections
  const gmatQuant = await prisma.examSection.upsert({
    where: { exam_id_section_order: { exam_id: gmat.id, section_order: 1 } },
    update: {},
    create: {
      exam_id: gmat.id,
      name: 'Quantitative',
      section_order: 1,
      duration_minutes: 62,
      question_count: 31,
      description: 'Tests problem solving and data sufficiency skills.',
    },
  });

  const gmatVerbal = await prisma.examSection.upsert({
    where: { exam_id_section_order: { exam_id: gmat.id, section_order: 2 } },
    update: {},
    create: {
      exam_id: gmat.id,
      name: 'Verbal',
      section_order: 2,
      duration_minutes: 65,
      question_count: 36,
      description: 'Tests reading comprehension, critical reasoning, and sentence correction.',
    },
  });

  console.log('✅ Created GMAT sections');

  // Create GMAT Questions
  const gmatQuantQuestions = [
    {
      exam_id: gmat.id,
      section_id: gmatQuant.id,
      question_text: 'If x² = 49, what are all possible values of x?',
      question_type: QuestionType.MULTIPLE_CHOICE,
      options: [
        { id: 'A', text: '7 only', correct: false },
        { id: 'B', text: '-7 only', correct: false },
        { id: 'C', text: '7 and -7', correct: true },
        { id: 'D', text: '49', correct: false },
        { id: 'E', text: 'Cannot be determined', correct: false },
      ],
      correct_answer: { answer: 'C' },
      difficulty_level: 2,
      topic: 'Algebra',
      subtopic: 'Quadratic Equations',
      skills: ['algebra', 'problem-solving'],
      explanation: 'The square root of 49 is ±7, so x can be either 7 or -7.',
      time_estimate_seconds: 60,
    },
    {
      exam_id: gmat.id,
      section_id: gmatQuant.id,
      question_text: 'Data Sufficiency: Is x > 0?\n(1) x² > 0\n(2) x³ > 0',
      question_type: QuestionType.MULTIPLE_CHOICE,
      options: [
        { id: 'A', text: 'Statement (1) ALONE is sufficient', correct: false },
        { id: 'B', text: 'Statement (2) ALONE is sufficient', correct: true },
        { id: 'C', text: 'BOTH statements TOGETHER are sufficient', correct: false },
        { id: 'D', text: 'EACH statement ALONE is sufficient', correct: false },
        { id: 'E', text: 'Statements (1) and (2) TOGETHER are NOT sufficient', correct: false },
      ],
      correct_answer: { answer: 'B' },
      difficulty_level: 4,
      topic: 'Data Sufficiency',
      subtopic: 'Inequalities',
      skills: ['logic', 'algebra'],
      explanation: 'Statement (1) is not sufficient because x² > 0 for both positive and negative x. Statement (2) is sufficient because x³ > 0 only when x > 0.',
      time_estimate_seconds: 120,
    },
  ];

  await prisma.question.createMany({
    data: gmatQuantQuestions,
  });

  console.log(`✅ Created ${gmatQuantQuestions.length} GMAT questions`);

  // Summary
  const examCount = await prisma.exam.count();
  const sectionCount = await prisma.examSection.count();
  const questionCount = await prisma.question.count();

  console.log('\n🎉 Seed complete!');
  console.log(`📊 Summary:`);
  console.log(`   - Exams: ${examCount}`);
  console.log(`   - Sections: ${sectionCount}`);
  console.log(`   - Questions: ${questionCount}`);
}

main()
  .catch((e) => {
    console.error('❌ Error seeding database:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });

```

**C:\Users\Plange\Downloads\Projects\answly\dev\docker-compose.yml**
```
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: answly-postgres
    environment:
      POSTGRES_USER: answly
      POSTGRES_PASSWORD: answly_dev_password
      POSTGRES_DB: answly_dev
    ports:
      - '5432:5432'
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U answly']
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: answly-redis
    ports:
      - '6379:6379'
    volumes:
      - redis_data:/data
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 10s
      timeout: 5s
      retries: 5

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: answly-backend
    environment:
      DATABASE_URL: postgresql://answly:answly_dev_password@postgres:5432/answly_dev
      REDIS_URL: redis://redis:6379
      JWT_SECRET: dev_jwt_secret_change_in_production
      JWT_EXPIRATION: 7d
      PORT: 4000
    ports:
      - '4000:4000'
    volumes:
      - ./backend:/app
      - /app/node_modules
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    command: npm run start:dev

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    container_name: answly-frontend
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:4000
    ports:
      - '3000:3000'
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - /app/.next
    depends_on:
      - backend
    command: npm run dev

volumes:
  postgres_data:
  redis_data:

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\.env.example**
```
# Database
DATABASE_URL="postgresql://answly:answly_dev_password@localhost:5432/answly_dev"

# Redis
REDIS_URL="redis://localhost:6379"

# JWT
JWT_SECRET="change_this_to_a_secure_random_string_in_production"
JWT_EXPIRATION="7d"
JWT_REFRESH_SECRET="change_this_to_another_secure_random_string"
JWT_REFRESH_EXPIRATION="30d"

# Server
PORT=4000
NODE_ENV="development"

# CORS
CORS_ORIGIN="http://localhost:3000"

# Rate Limiting
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100

# AI Providers (for Phase 2)
OPENAI_API_KEY=""
ANTHROPIC_API_KEY=""
COHERE_API_KEY=""

# Pinecone (for Phase 2 - RAG)
PINECONE_API_KEY=""
PINECONE_ENVIRONMENT=""
PINECONE_INDEX=""

# Stripe (for Phase 3 - Billing)
STRIPE_SECRET_KEY="sk_test_..."
STRIPE_PUBLISHABLE_KEY="pk_test_..."
STRIPE_WEBHOOK_SECRET="whsec_..."
STRIPE_PRICE_GROWTH="price_..." # $29/month (Growth tier)
STRIPE_PRICE_SCALE="price_..."   # $99/month (Scale tier)
STRIPE_PRICE_ENTERPRISE="price_..." # Optional
# Backwards compat (fallbacks if above are not set)
STRIPE_PRICE_GO="price_..."   
STRIPE_PRICE_PLUS="price_..."
STRIPE_PRICE_PRO="price_..."

# PayPal Sandbox (feature-flagged; Stripe is default)
PAYPAL_SANDBOX_ENABLED=false
PAYPAL_SANDBOX_CLIENT_ID=""
# Country-based provider routing (e.g., IN -> paypal, US -> stripe)
PAYMENT_PROVIDER_COUNTRY_MAP='{"IN":"paypal","US":"stripe"}'

# Regional Providers (disabled by default unless fully configured)
RAZORPAY_ENABLED=false
RAZORPAY_API_KEY=""
RAZORPAY_API_SECRET=""
RAZORPAY_WEBHOOK_SECRET=""

MERCADOPAGO_ENABLED=false
MERCADOPAGO_API_KEY=""
MERCADOPAGO_WEBHOOK_SECRET=""

ALIPAY_ENABLED=false
ALIPAY_API_KEY=""
ALIPAY_API_SECRET=""
ALIPAY_WEBHOOK_SECRET=""

# Stripe Tax
STRIPE_TAX_ENABLED=false

# Email (for password reset)
SMTP_HOST=""
SMTP_PORT=587
SMTP_USER=""
SMTP_PASS=""
FROM_EMAIL="noreply@answly.com"

```

**C:\Users\Plange\Downloads\Projects\answly\dev\frontend\.env.example**
```
# API Configuration
NEXT_PUBLIC_API_URL=http://localhost:4000

# App Configuration
NEXT_PUBLIC_APP_NAME=Answly
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Stripe Configuration (for Vercel deployment)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
# Note: Never expose the secret key in frontend env variables!

```

**C:\Users\Plange\Downloads\Projects\answly\dev\frontend\README.md**
```
# Answly Frontend

Next.js 14 application with App Router, TypeScript, and TailwindCSS.

## Features Implemented

### Phase 1, Session 1 ✅
- ✅ Next.js 14 with App Router
- ✅ TypeScript configuration
- ✅ TailwindCSS + ShadCN UI components
- ✅ Authentication pages (Login/Register)
- ✅ Auth state management (Zustand)
- ✅ API client with interceptors
- ✅ Protected routes
- ✅ Responsive design

## Project Structure

```
src/
├── app/                  # Next.js App Router pages
│   ├── login/           # Login page
│   ├── register/        # Register page
│   ├── dashboard/       # Protected dashboard
│   ├── layout.tsx       # Root layout
│   ├── page.tsx         # Home page
│   └── globals.css      # Global styles
├── components/
│   ├── ui/              # ShadCN UI components
│   └── providers.tsx    # React Query provider
├── lib/
│   ├── api-client.ts    # Axios instance with auth
│   └── utils.ts         # Utility functions
└── store/
    └── auth-store.ts    # Auth state (Zustand)
```

## Available Scripts

```bash
# Development
npm run dev          # Start dev server on :3000

# Build
npm run build        # Production build
npm start            # Start production server

# Code Quality
npm run lint         # Run ESLint
npm run type-check   # TypeScript type checking
```

## Environment Variables

Create `.env.local`:

```env
NEXT_PUBLIC_API_URL=http://localhost:4000
```

## Tech Stack

- **Framework**: Next.js 14
- **Language**: TypeScript
- **Styling**: TailwindCSS
- **UI Components**: ShadCN UI
- **State Management**: Zustand
- **Data Fetching**: TanStack Query
- **HTTP Client**: Axios

## Next Steps

Session 2 will add:
- Exam catalog pages
- Question browsing
- Search functionality

```

**C:\Users\Plange\Downloads\Projects\answly\dev\frontend\package.json**
```
{
  "name": "answly-frontend",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "@axe-core/react": "^4.11.0",
    "@azure/msal-browser": "^4.26.1",
    "@next/eslint-plugin-next": "^16.0.1",
    "@radix-ui/react-avatar": "^1.0.4",
    "@radix-ui/react-checkbox": "^1.0.4",
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-dropdown-menu": "^2.0.6",
    "@radix-ui/react-label": "^2.0.2",
    "@radix-ui/react-progress": "^1.1.8",
    "@radix-ui/react-radio-group": "^1.1.3",
    "@radix-ui/react-select": "^2.0.0",
    "@radix-ui/react-slot": "^1.0.2",
    "@radix-ui/react-tabs": "^1.0.4",
    "@radix-ui/react-toast": "^1.1.5",
    "@sentry/nextjs": "^10.23.0",
    "@tanstack/react-query": "^5.17.19",
    "axios": "^1.6.5",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "eslint-plugin-jsx-a11y": "^6.10.2",
    "katex": "^0.16.25",
    "lucide-react": "^0.309.0",
    "next": "^14.1.0",
    "next-intl": "^4.5.0",
    "next-pwa": "^5.6.0",
    "papaparse": "^5.5.3",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-katex": "^3.1.0",
    "recharts": "^3.4.1",
    "socket.io-client": "^4.7.2",
    "tailwind-merge": "^2.2.0",
    "tailwindcss-animate": "^1.0.7",
    "web-vitals": "^5.1.0",
    "zustand": "^4.4.7"
  },
  "devDependencies": {
    "@types/node": "^20.10.6",
    "@types/react": "^18.2.47",
    "@types/react-dom": "^18.2.18",
    "autoprefixer": "^10.4.16",
    "eslint": "^8.56.0",
    "eslint-config-next": "^14.1.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "^5.3.3"
  }
}

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\main.ts**
```
import { NestFactory } from '@nestjs/core';
import { ValidationPipe } from '@nestjs/common';
import { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';
import helmet from 'helmet';
import * as compression from 'compression';
import { AppModule } from './app.module';

async function bootstrap() {
  // Enable access to rawBody for Stripe webhook signature verification
  const app = await NestFactory.create(AppModule, { rawBody: true });

  // Security headers
  app.use(helmet({
    crossOriginEmbedderPolicy: false,
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        scriptSrc: ["'self'", "'unsafe-inline'", "'unsafe-eval'"],
        imgSrc: ["'self'", 'data:', 'https:'],
      },
    },
  }));

  // Compression
  app.use(compression());

  // Global validation pipe
  app.useGlobalPipes(
    new ValidationPipe({
      whitelist: true,
      forbidNonWhitelisted: true,
      transform: true,
    }),
  );

  // CORS configuration
  app.enableCors({
    origin: process.env.CORS_ORIGIN || 'http://localhost:3000',
    credentials: true,
  });

  // Swagger API documentation
  const config = new DocumentBuilder()
    .setTitle('Answly API')
    .setDescription('Answly Backend API Documentation')
    .setVersion('1.0')
    .addBearerAuth()
    .addTag('Authentication', 'User authentication endpoints')
    .addTag('Users', 'User management endpoints')
    .addTag('Exams', 'Exam catalog and management')
    .addTag('Questions', 'Question bank management')
    .addTag('Test Sessions', 'Test-taking and session management')
    .addTag('Admin', 'Administrative operations')
    .addTag('Audit Logs', 'Audit logging and tracking')
    .build();
  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api', app, document);

  const port = process.env.PORT || 4000;
  await app.listen(port);
  console.log(`🚀 Answly API is running on: http://localhost:${port}`);
  console.log(`📚 API Documentation: http://localhost:${port}/api`);
  console.log(`🔒 Security: Helmet + Rate Limiting enabled`);
  console.log(`⚡ Performance: Caching + Compression enabled`);
}

bootstrap();

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\app.module.ts**
```
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { APP_GUARD } from '@nestjs/core';
import { ThrottlerModule, ThrottlerGuard } from '@nestjs/throttler';
import { PrismaModule } from './prisma/prisma.module';
import { CacheModule } from './cache/cache.module';
import { AuthModule } from './auth/auth.module';
import { UsersModule } from './users/users.module';
import { ExamsModule } from './exams/exams.module';
import { QuestionsModule } from './questions/questions.module';
import { TestSessionsModule } from './test-sessions/test-sessions.module';
import { GradingModule } from './grading/grading.module';
import { AdminModule } from './admin/admin.module';
import { AuditLogsModule } from './audit-logs/audit-logs.module';
import { AIModule } from './ai/ai.module';
import { BillingModule } from './billing/billing.module';
import { EnterpriseModule } from './enterprise/enterprise.module';
import { ComplianceModule } from './compliance/compliance.module';
import { JwtAuthGuard } from './auth/guards/jwt-auth.guard';
import { ScheduleModule } from '@nestjs/schedule';

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
    }),
    ThrottlerModule.forRoot([
      {
        ttl: 60000, // 60 seconds
        limit: 100, // 100 requests per minute
      },
    ]),
    PrismaModule,
    CacheModule,
    ScheduleModule.forRoot(),
    AuthModule,
    UsersModule,
    ExamsModule,
    QuestionsModule,
    TestSessionsModule,
    GradingModule,
    AdminModule,
    AuditLogsModule,
    AIModule,
    BillingModule,
    EnterpriseModule,
    ComplianceModule,
  ],
  providers: [
    {
      provide: APP_GUARD,
      useClass: JwtAuthGuard,
    },
    {
      provide: APP_GUARD,
      useClass: ThrottlerGuard,
    },
  ],
})
export class AppModule {}

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\prisma\prisma.module.ts**
```
import { Module, Global } from '@nestjs/common';
import { PrismaService } from './prisma.service';

@Global()
@Module({
  providers: [PrismaService],
  exports: [PrismaService],
})
export class PrismaModule {}

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\src\prisma\prisma.service.ts**
```
import { Injectable, OnModuleInit, OnModuleDestroy } from '@nestjs/common';
import { PrismaClient } from '@prisma/client';

@Injectable()
export class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy {
  async onModuleInit() {
    await this.$connect();
    console.log('✅ Database connected');
  }

  async onModuleDestroy() {
    await this.$disconnect();
    console.log('❌ Database disconnected');
  }

  async cleanDatabase() {
    // Helper for testing - deletes all data
    if (process.env.NODE_ENV === 'production') {
      throw new Error('Cannot clean database in production');
    }

    const models = Reflect.ownKeys(this).filter(
      (key) => key !== '_engine' && !key.toString().startsWith('$'),
    );

    return Promise.all(
      models.map((modelKey) => {
        const model = this[modelKey as string];
        if (model && typeof model.deleteMany === 'function') {
          return model.deleteMany();
        }
      }),
    );
  }
}

```

**C:\Users\Plange\Downloads\Projects\answly\dev\backend\nest-cli.json**
```
{
  "$schema": "https://json.schemastore.org/nest-cli",
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "compilerOptions": {
    "deleteOutDir": true,
    "webpack": true
  }
}

```

**C:\Users\Plange\Downloads\Projects\answly\notes\README.md**
```
# Answly Technical Specification
## Complete Implementation Blueprint

**Version:** 1.0  
**Last Updated:** November 2024  
**Status:** Production-Ready  

---

## Overview

This technical specification provides a comprehensive, production-ready implementation blueprint for **Answly** — a web platform delivering high-fidelity, exam-like practice for standardized and professional tests (SAT, GRE, GMAT, CFA, CPA, TOEFL, and more).

The specification is designed for a 3-6 engineer team to begin immediate implementation, with detailed architecture, data models, APIs, UX wireframes, and AI/ML pipelines.

---

## Document Structure

The specification is organized into 6 interconnected documents:

### **[Part 1: Platform Overview & Features](./01-platform-overview-and-features.md)**
- Mission and supported exams (15+ exam types)
- Non-functional requirements (99.95% uptime, <200ms latency)
- Detailed feature matrix (Starter, Grow, Scale, Enterprise tiers)
- User roles & RBAC permission matrix
- Pricing strategy & access control logic

**Key Sections:**
- 1.1 Mission & Exam Catalog
- 2.1-2.4 Feature Breakdown by Tier
- 3.1-3.2 RBAC & Permissions
- 4.1 Pricing & Billing

---

### **[Part 2: UX Wireframes & System Architecture](./02-ux-wireframes-architecture.md)**
- ChatGPT-style homepage layout (3-column: sidebar, main, right panel)
- Test-taking UI with specialized interfaces (essay, calculator, listening)
- Results & analytics dashboard designs
- High-level system architecture diagram
- Technology stack (Next.js, NestJS, PostgreSQL, Redis, AI providers)

**Key Sections:**
- 4.1 Homepage Layout (desktop/mobile wireframes)
- 4.2 Test-Taking Interface (question types, navigation, timer)
- 4.3 Results Dashboard (scores, insights, recommendations)
- 5.1 Architecture Diagram (frontend → backend → databases)
- 5.2 Tech Stack Matrix

---

### **[Part 3: AI/ML Architecture](./03-ai-ml-architecture.md)**
- Multi-provider AI orchestration (OpenAI, Anthropic, Cohere, HuggingFace)
- Question generation pipeline (7-stage process)
- Content validation & quality control (automated checks)
- Item Response Theory (IRT) implementation for difficulty calibration
- AI tool recommendations & use cases

**Key Sections:**
- 6.2 Multi-Provider Architecture (fallback logic)
- 6.3 Question Generation Pipeline (prompt templates)
- 6.4 Content Validation (5 automated checks)
- 6.5 IRT Calibration (3PL model, theta estimation)
- 7.1 Provider Comparison Matrix

---

### **[Part 4: Database Schema & API Design](./04-database-schema-and-apis.md)**
- Complete Prisma schema (25+ models)
- Core tables: Users, Exams, Questions, TestSessions, Attempts
- Analytics tables: IRT profiles, session analytics
- Billing tables: Subscriptions, invoices, usage records
- AI tables: Generation jobs, question reviews
- REST API endpoint specifications (50+ endpoints)

**Key Sections:**
- 8.1 Full Prisma Schema (with indexes, relations)
- 9.1 API Endpoints (Auth, Exams, Tests, Analytics, AI, Admin)
- 9.2 WebSocket Events (real-time test-taking)

---

### **[Part 5: Workflows & Implementation](./05-workflows-and-implementation.md)**
- Step-by-step workflows (signup, test-taking, AI generation, subscriptions)
- Frontend file structure (Next.js app directory)
- Backend file structure (NestJS modules)
- Code examples (DTOs, services, guards)
- Development best practices

**Key Sections:**
- 10.1-10.5 Key Workflows (user signup, test flow, AI generation, billing, organizations)
- 11.1 Frontend Structure (Next.js with ShadCN)
- 11.2 Backend Structure (NestJS modules)
- 11.3 Code Examples (TypeScript implementation)

---

### **[Part 6: Security, Testing, Deployment & Appendices](./06-security-testing-deployment.md)**
- Authentication & authorization (JWT, OAuth, RBAC)
- API security (rate limiting, input validation, CORS)
- GDPR compliance (data export, right to be forgotten)
- Proctoring & exam integrity
- Testing strategy (unit, integration, e2e, load)
- Monitoring & observability
- CI/CD pipeline
- Sample AI prompts and API responses

**Key Sections:**
- 12.1-12.4 Security (auth, encryption, GDPR, proctoring)
- 13.1-13.6 Testing (Jest, Playwright, k6, AI validation)
- 14.1-14.3 Operations (monitoring, scaling, disaster recovery)
- 15.1-15.2 Deployment (AWS infra, GitHub Actions)
- 16.1-16.4 Appendices (prompts, examples, feature matrix)

---

## Quick Navigation

### For Product Managers
- **Features**: Part 1, Section 2
- **Pricing**: Part 1, Section 4
- **UX**: Part 2, Section 4

### For Frontend Engineers
- **UI Wireframes**: Part 2, Section 4
- **Component Structure**: Part 5, Section 11.1
- **API Integration**: Part 4, Section 9

### For Backend Engineers
- **Database Schema**: Part 4, Section 8
- **API Endpoints**: Part 4, Section 9
- **Service Implementation**: Part 5, Section 11.2-11.3

### For ML Engineers
- **AI Architecture**: Part 3, Sections 6-7
- **Generation Pipeline**: Part 3, Section 6.3
- **IRT Implementation**: Part 3, Section 6.5

### For DevOps Engineers
- **Architecture**: Part 2, Section 5
- **Security**: Part 6, Section 12
- **Deployment**: Part 6, Section 15

---

## Technology Stack Summary

**Frontend:**
- Next.js 14 (App Router, Server Components)
- React 18, TypeScript 5
- TailwindCSS, ShadCN UI
- Zustand (state), TanStack Query (data fetching)
- KaTeX (math), Monaco (code editor)

**Backend:**
- NestJS 10, TypeScript 5
- Prisma ORM (PostgreSQL)
- JWT (auth), Passport.js
- BullMQ (job queue)

**Databases:**
- PostgreSQL 15 (primary data)
- Redis 7 (cache, sessions, rate limiting)
- ElasticSearch 8 (full-text search)
- Pinecone/Weaviate (vector store)

**AI/ML:**
- OpenAI (GPT-4 Turbo)
- Anthropic (Claude 3)
- Cohere (embeddings)
- LangChain (orchestration)
- IRT (3-parameter logistic model)

**Infrastructure:**
- AWS (ECS, RDS, S3, CloudFront, ALB)
- CloudFlare (CDN, DDoS protection)
- Stripe (payments)
- SendGrid (email)
- Sentry (error tracking)
- Datadog (monitoring)

---

## Key Features

### Exam Fidelity
- Pixel-perfect UI replication of real exams
- Authentic timing, section order, question types
- Exact mark schemes and scoring algorithms

### AI-Powered Content
- Automated question generation (GPT-4/Claude)
- Step-by-step explanations
- Conversational AI tutor
- Personalized study plans
- Multi-provider fallback for reliability

### Advanced Analytics
- Item Response Theory (IRT) scoring
- Percentile rankings (global, regional, cohort)
- Topic/skill breakdown
- Predictive scoring (estimate actual exam score)
- Psychometric analysis (discrimination, difficulty)

### Multi-Tier Access
- **Starter**: 3 tests/month, basic features
- **Grow**: Unlimited tests, AI tutor, advanced analytics ($29/mo)
- **Scale**: Multi-user, org dashboard, proctoring ($99/mo)
- **Enterprise**: Custom, white-label, SSO, API access

### Enterprise Ready
- SSO integration (SAML, OAuth, LDAP)
- White-label branding
- Remote proctoring (ProctorU, Proctorio)
- Bulk user management
- API access for LMS integration

---

## Non-Functional Requirements

| Metric | Target | Notes |
|--------|--------|-------|
| **Availability** | 99.95% | Monthly SLA, multi-AZ deployment |
| **Latency (API)** | <200ms p95 | API Gateway + CDN caching |
| **Test Loading** | <3s | Question pre-loading, Redis cache |
| **Concurrent Users** | 100k+ | Auto-scaling ECS, read replicas |
| **Data Durability** | 11 9's | S3 + RDS backups |
| **Security** | SOC 2 Type II | Annual audit, encryption at rest/transit |
| **Mobile Performance** | Lighthouse >90 | PWA with offline support |
| **AI Response** | <5s p95 | Multi-provider with fallback |

---

## Implementation Roadmap

### Phase 1: Foundation (3 months)
- Auth system (JWT, OAuth)
- Exam catalog & question bank
- Test-taking UI (MCQ, numeric, essay)
- Basic grading & results
- Admin panel (CRUD questions)

**Deliverables:**
- Users can sign up, take tests, see results
- Admins can manage content
- 3 exam types (GRE, SAT, GMAT)

---

### Phase 2: AI Integration (2 months)
- Question generation pipeline
- Content validation & review queue
- AI tutor chatbot
- Explanation generation
- IRT calibration

**Deliverables:**
- Auto-generate 1000+ questions per exam
- AI tutor with RAG
- Difficulty calibration using IRT

---

### Phase 3: Grow Features (2 months)
- Advanced analytics dashboard
- Subscription billing (Stripe)
- Personalized study plans
- Performance insights
- Usage metering

**Deliverables:**
- Grow/Scale tiers live
- Revenue generation
- Detailed user analytics

---

### Phase 4: Enterprise (1 month)
- Organization accounts
- SSO integration
- Proctoring integration
- White-label branding
- API for external LMS

**Deliverables:**
- Enterprise sales-ready
- Large customer support
- API documentation

---

**Total Timeline:** 8 months to full launch

---

## Getting Started

### Prerequisites
- Node.js 18+
- PostgreSQL 15+
- Redis 7+
- Docker (for local dev)
- AWS account (for deployment)

### Setup Instructions

1. **Clone & Install**
   ```bash
   git clone https://github.com/your-org/answly
   cd answly
   npm install
   ```

2. **Environment Setup**
   ```bash
   cp .env.example .env
   # Configure DATABASE_URL, REDIS_URL, JWT_SECRET, etc.
   ```

3. **Database Migration**
   ```bash
   npx prisma migrate dev
   npx prisma db seed  # Load sample exams
   ```

4. **Run Development Servers**
   ```bash
   # Frontend (Next.js)
   cd frontend && npm run dev  # http://localhost:3000
   
   # Backend (NestJS)
   cd backend && npm run start:dev  # http://localhost:4000
   ```

5. **Run Tests**
   ```bash
   npm test              # Unit tests
   npm run test:e2e      # E2E tests (Playwright)
   npm run test:load     # Load tests (k6)
   ```

---

## Support & Contact

For questions or clarifications on this specification:

- **Technical Lead**: [Your Name]
- **Email**: tech@answly.com
- **Slack**: #answly-engineering
- **Documentation**: https://docs.answly.com

---

## License

This technical specification is proprietary and confidential.  
© 2024 Answly. All rights reserved.

---

**Document Status:** ✅ Ready for Implementation  
**Last Review:** November 9, 2024  
**Next Review:** December 9, 2024

```

**C:\Users\Plange\Downloads\Projects\answly\notes\phases\README.md**
```
# Answly Implementation Roadmap
## Complete Guide to Building Answly

**📅 Timeline:** 32 weeks (8 months)  
**👥 Team:** 3-6 engineers  
**💰 Budget:** ~$810,000 (team + infrastructure)  
**🎯 Goal:** Production-ready exam practice platform

---

## 📚 Documentation Structure

This implementation guide is organized into 6 comprehensive documents:

### **[00 - Roadmap Overview](./00-roadmap-overview.md)**
High-level project plan, team structure, budget, and success metrics.

**Key Topics:**
- Phase overview and timeline
- Team structure and roles
- Quality gates and risk management
- Budget breakdown
- Success metrics by phase

**Read this first** to understand the big picture.

---

### **[Phase 1 - Foundation](./01-phase1-foundation.md)** (12 weeks)
Build core platform with auth, test-taking, and content management.

**Sessions:**
1. Infrastructure & Auth (Weeks 1-2)
2. Exam Catalog & Data Models (Weeks 3-4)
3. Test-Taking UI - Part 1 (Weeks 5-6)
4. Test-Taking UI - Part 2 (Weeks 7-8)
5. Admin Panel & Content Management (Weeks 9-10)
6. Polish, Testing & Launch Prep (Weeks 11-12)

**Deliverables:**
- ✅ User authentication
- ✅ 3 exam types (GRE, SAT, GMAT)
- ✅ Full test-taking experience
- ✅ Auto-grading and results
- ✅ Admin content management
- ✅ 1500+ questions loaded

---

### **[Phase 2 - AI Integration](./02-phase2-ai-integration.md)** (8 weeks)
Add AI-powered question generation, tutoring, and personalization.

**Sessions:**
1. AI Infrastructure & Providers (Weeks 13-14)
2. Question Generation Pipeline (Weeks 15-16)
3. AI Tutor & Explanations (Weeks 17-18)
4. IRT Calibration & Personalization (Weeks 19-20)

**Deliverables:**
- ✅ Question generation (1000+ per exam)
- ✅ AI tutor with RAG
- ✅ Content validation pipeline
- ✅ IRT calibration (3PL model)
- ✅ Personalized recommendations
- ✅ Adaptive question selection

---

### **[Phase 3 - Monetization](./03-phase3-monetization.md)** (8 weeks)
Launch paid tiers, billing, and advanced analytics.

**Sessions:**
1. Stripe Integration & Billing (Weeks 21-22)
2. Advanced Analytics Dashboard (Weeks 23-24)
3. Usage Tracking & Optimization (Weeks 25-26)
4. Polish & Revenue Optimization (Weeks 27-28)

**Deliverables:**
- ✅ Stripe billing integration
- ✅ 3 tiers (Starter, Grow, Scale)
- ✅ Usage metering and limits
- ✅ Advanced analytics dashboard
- ✅ Business metrics tracking
- ✅ Export functionality (PDF/CSV)

---

### **[Phase 4 - Enterprise](./04-phase4-enterprise.md)** (4 weeks)
Make platform enterprise-ready with SSO, white-label, and API.

**Sessions:**
1. SSO & Organization Management (Weeks 29-30)
2. White-Label, Proctoring & API (Weeks 31-32)

**Deliverables:**
- ✅ SSO (SAML, OAuth)
- ✅ Organization management
- ✅ White-label customization
- ✅ Remote proctoring
- ✅ Public API for LMS
- ✅ Custom domain support

---

### **[Phase 5 - Optional: On‑Prem](./05-onprem-deployment.md)** (4 weeks)
Self-hosted deployment (can run after Phase 4 or in parallel with pilots).

**Deliverables:**
- ✅ Helm/Terraform packaging, pluggable services (MinIO/OpenSearch/Weaviate)
- ✅ DR/backup runbook, licensing & telemetry (opt‑in)

---

## 🗓️ Quick Timeline Reference

```
Month 1-3: Phase 1 - Foundation
├─ Week 1-2:   Infrastructure & Auth
├─ Week 3-4:   Exam Catalog
├─ Week 5-6:   Test-Taking UI (Part 1)
├─ Week 7-8:   Test-Taking UI (Part 2)
├─ Week 9-10:  Admin Panel
└─ Week 11-12: Polish & Testing

Month 4-5: Phase 2 - AI Integration
├─ Week 13-14: AI Infrastructure
├─ Week 15-16: Question Generation
├─ Week 17-18: AI Tutor
└─ Week 19-20: IRT & Personalization

Month 6-7: Phase 3 - Monetization
├─ Week 21-22: Stripe Integration
├─ Week 23-24: Analytics Dashboard
├─ Week 25-26: Usage Tracking
└─ Week 27-28: Revenue Optimization

Month 8: Phase 4 - Enterprise
├─ Week 29-30: SSO & Organizations
└─ Week 31-32: White-Label & API

🚀 Launch!

Optional Track (Post‑Launch or Parallel): Phase 5
└─ Week 33-36: On‑Prem Packaging & DR
```

---

## 📊 Key Metrics to Track

### By End of Each Phase

| Metric | Phase 1 | Phase 2 | Phase 3 | Phase 4 |
|--------|---------|---------|---------|---------|
| **Features** |
| Exams Available | 3 | 3 | 3 | 3+ |
| Questions per Exam | 500 | 1500+ | 2000+ | 3000+ |
| AI-Generated Questions | 0 | 1000+ | 2000+ | 3000+ |
| **Technical** |
| API Response Time | <200ms | <200ms | <200ms | <200ms |
| Page Load Time | <3s | <3s | <3s | <3s |
| Test Coverage | >80% | >80% | >80% | >80% |
| Concurrent Users | 1k | 5k | 10k | 50k |
| **Business** |
| Active Users | 100 | 500 | 2000 | 5000 |
| Paying Customers | 0 | 0 | 50+ | 100+ |
| MRR | $0 | $0 | $5k+ | $20k+ |
| Conversion Rate | - | - | >5% | >5% |

---

## 🎯 Critical Success Factors

### Phase Gates
Each phase has strict quality gates that must be passed before proceeding:

**Phase 1 Gate:**
- [ ] All 3 exams functional
- [ ] No data loss in 100 test submissions
- [ ] Load test passed (1000 users)
- [ ] Security audit clean

**Phase 2 Gate:**
- [ ] >90% AI question approval rate
- [ ] AI tutor <5s response time
- [ ] IRT calibration working
- [ ] Generation cost <$0.10/question

**Phase 3 Gate:**
- [ ] Stripe in production mode
- [ ] >5% conversion rate
- [ ] Churn <10%
- [ ] Usage limits enforced

**Phase 4 Gate:**
- [ ] SSO working (2+ providers)
- [ ] API documented
- [ ] 2+ enterprise deals
- [ ] SOC 2 audit started

### Don't Skip Testing
- Unit tests (>80% coverage)
- Integration tests (critical paths)
- E2E tests (user journeys)
- Load tests (target capacity)
- Security scans (weekly)

### Monitor Everything
- Error rates and performance
- User behavior and conversion
- AI costs and quality
- Infrastructure health

---

## 🚀 Getting Started

### Prerequisites
- [ ] Team assembled (3-6 engineers)
- [ ] AWS account set up
- [ ] GitHub organization created
- [ ] Domain registered
- [ ] Budget approved

### Week 0 Checklist
- [ ] Read all phase documents
- [ ] Set up development environment
- [ ] Create project management board
- [ ] Schedule kick-off meeting
- [ ] Establish communication channels

### First Sprint
Start with **[Phase 1, Session 1](./01-phase1-foundation.md#session-1-infrastructure--auth-weeks-1-2)**:
- Set up Next.js + NestJS
- Configure PostgreSQL + Prisma
- Implement JWT authentication
- Deploy to staging

---

## 📖 Additional Resources

### Technical Specifications
- **[Complete Technical Spec](../README.md)** - Full platform architecture
- **[Database Schema](../04-database-schema-and-apis.md)** - Prisma models
- **[AI Architecture](../03-ai-ml-architecture.md)** - ML pipelines
- **[Security Guide](../06-security-testing-deployment.md)** - Security best practices

### Code Examples
Each phase document contains:
- ✅ TypeScript code snippets
- ✅ API endpoint examples
- ✅ Frontend component samples
- ✅ Test examples
- ✅ Configuration files

### Checkpoints
Every session has clear checkpoints:
- ✅ Acceptance criteria
- ✅ Testing requirements
- ✅ Performance benchmarks
- ✅ Documentation needs

---

## 👥 Team Responsibilities

### Tech Lead
- Architecture decisions
- Code review oversight
- Sprint planning
- Stakeholder communication

### Frontend Engineers (2)
- Next.js application
- UI components (ShadCN)
- State management
- E2E testing

### Backend Engineers (2)
- NestJS API
- Database design
- Third-party integrations
- Performance optimization

### ML/AI Engineer (1)
- AI provider integration
- Question generation pipeline
- IRT implementation
- Model optimization

### DevOps (part-time)
- CI/CD pipeline
- Infrastructure as code
- Monitoring setup
- Deployment automation

---

## 💡 Tips for Success

### Do's ✅
- ✅ Follow the phase sequence
- ✅ Complete checkpoints before moving on
- ✅ Write tests as you go
- ✅ Document architecture decisions
- ✅ Monitor metrics continuously
- ✅ Get stakeholder approval at gates

### Don'ts ❌
- ❌ Skip testing to save time
- ❌ Build features not in roadmap
- ❌ Ignore technical debt
- ❌ Deploy without code review
- ❌ Proceed past gates without approval
- ❌ Over-engineer early phases

### When Things Go Wrong
- Review the checkpoint criteria
- Check similar patterns in code examples
- Consult the technical specification
- Ask for help (document blockers)
- Adjust timeline if needed (inform stakeholders)

---

## 📞 Support & Questions

**For Technical Questions:**
- Review relevant phase document
- Check code examples in specifications
- Consult technical specification docs

**For Process Questions:**
- Review roadmap overview
- Check quality gates
- Consult with Tech Lead

**For Scope Questions:**
- Review original requirements
- Check feature specifications
- Consult Product Manager

---

## 🎓 Learning Path

**Before Starting:**
1. Read [Roadmap Overview](./00-roadmap-overview.md)
2. Review [Technical Spec](../README.md)
3. Understand team structure

**During Development:**
1. Follow current phase document
2. Complete checkpoints in order
3. Review code examples
4. Track metrics

**At Phase Gates:**
1. Review all deliverables
2. Run full test suite
3. Get stakeholder sign-off
4. Plan next phase

---

## 📈 Progress Tracking

### Sprint Reports
Track weekly:
- Story points completed
- Bugs found/fixed
- Tests written/passing
- Documentation updated

### Phase Reports
Track per phase:
- Features delivered
- Quality metrics
- Technical debt
- Team velocity

### Project Dashboard
Monitor overall:
- Phases completed
- Budget spent
- Timeline status
- Risk register

---

## 🏁 Launch Readiness

Before going live, ensure:
- [ ] All phases complete
- [ ] All gates passed
- [ ] Security audit done
- [ ] Load testing passed
- [ ] Monitoring configured
- [ ] Support team trained
- [ ] Legal agreements signed
- [ ] Marketing ready

**Then: 🚀 LAUNCH!**

---

## 🎉 Success Celebration

When you complete all phases:
- 🎯 You've built a production-ready exam platform
- 🤖 With AI-powered content generation
- 💰 With subscription monetization
- 🏢 Ready for enterprise customers
- 📈 Scalable to millions of users

**Congratulations! Time to grow! 🚀**

---

**Document Version:** 1.0  
**Last Updated:** November 2024  
**Next Review:** Start of each phase  
**Owner:** Tech Lead  
**Status:** ✅ Ready for Use

```



Here’s the current state and a concise path to production for the backend and database.

Backend and database status
- Stack: NestJS (TypeScript), Prisma ORM, PostgreSQL, Redis, BullMQ, Swagger, WebSockets, Throttler, Helmet, compression.
- Location: dev/backend
- DB schema: Prisma with extensive models (users, exams, questions, sessions, attempts, AI usage, billing, org/SSO, compliance). See dev/backend/prisma/schema.prisma.
- Dev runtime: docker-compose uses Dockerfile.dev for backend/frontend, plus local Postgres and Redis. See dev/docker-compose.yml.
- Env templates: dev/backend/.env.example and dev/frontend/.env.example
- Migrations/seed: prisma migrate dev and prisma db seed (dev). For prod: prisma migrate deploy.
- Swagger: served at /api. CORS configurable via env.
- Build scripts: npm run build → dist, npm run start:prod runs Node dist/main.

What’s missing for production
- Production Dockerfiles (only Dockerfile.dev exists).
- A production docker-compose (or infra manifests) that targets managed Postgres/Redis.
- CI/CD job to run prisma migrate deploy against production.
- Hardened env config (secrets, CORS origins, JWT refresh, Stripe webhook secrets).
- Healthchecks, logging, metrics wiring, backups/retention plan for DB/Redis.

Recommended production approach
Pick one of these (start simple, evolve later):

Option A (quickest, reliable)
- Frontend → Vercel
- Backend → Render/Railway/Fly/Heroku (Docker or Node buildpack)
- Database → Managed Postgres (Render/Railway/AWS RDS)
- Redis → Managed Redis (Upstash/Redis Cloud/ElastiCache)
- CI: build backend image, run prisma migrate deploy, then deploy.

Option B (single VM with Docker Compose)
- Use a managed DB/Redis.
- Run backend (and optionally frontend) as containers behind nginx/Traefik with TLS.
- Nightly DB backups, log shipping to a SaaS.

Option C (AWS scalable)
- Backend on ECS Fargate (ALB + target group healthcheck)
- RDS Postgres (multi-AZ), ElastiCache Redis
- CloudFront + S3 or Vercel for frontend
- GitHub Actions for CI/CD, run migrations as a pre-deploy job.

Concrete steps to production

1) Create production databases
- Postgres (managed): provision with daily automated backups, 7–30d retention, pgbouncer (or provider pooling), TLS required, separate app user with least-privilege.
- Redis (managed): enable TLS, set appropriate eviction policy (volatile-lru), alerts for memory and latency.

2) Prepare backend for production
- Create a production Dockerfile (multi-stage, non-root, healthcheck).
- Configure env: DATABASE_URL (managed), REDIS_URL (managed), CORS_ORIGIN (frontend domain), JWT_SECRET/REFRESH secrets, NODE_ENV=production.
- Rate limit: keep defaults; tune if needed.
- Logging: stdout structured logs; wire Sentry if desired.

Example production Dockerfile for backend
```dockerfile
# dev/backend/Dockerfile
FROM node:20-alpine AS builder
WORKDIR /app
ENV CI=true
COPY package*.json ./
RUN npm ci
COPY . .
# Generate Prisma client and build NestJS
RUN npx prisma generate
RUN npm run build
# Prune dev deps for a smaller runtime
RUN npm prune --omit=dev

FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV=production
# Create non-root user
RUN addgroup -S nodejs && adduser -S nodeuser -G nodejs
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package*.json ./
COPY --from=builder /app/dist ./dist
# Optional: copy prisma for runtime client metadata
COPY --from=builder /app/prisma ./prisma
USER nodeuser
EXPOSE 4000
HEALTHCHECK --interval=30s --timeout=3s --start-period=20s --retries=3 CMD wget -qO- http://127.0.0.1:4000/health || exit 1
CMD ["node", "dist/main"]
```
3) Production docker-compose (if self-hosting on a VM)
- Point to managed DB/Redis.
- No bind mounts. Use the production Dockerfile.

```yaml
# dev/docker-compose.prod.yml
version: "3.8"
services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: answly-backend:prod
    environment:
      NODE_ENV: production
      PORT: 4000
      DATABASE_URL: ${DATABASE_URL}
      REDIS_URL: ${REDIS_URL}
      JWT_SECRET: ${JWT_SECRET}
      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET}
      JWT_EXPIRATION: 7d
      JWT_REFRESH_EXPIRATION: 30d
      CORS_ORIGIN: ${CORS_ORIGIN}
    ports:
      - "4000:4000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://127.0.0.1:4000/health || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
```
4) Run production migrations safely
- Never use migrate dev in production. Use migrate deploy.
- Recommended: CI job runs migrations against the production DATABASE_URL before rolling out the new backend task/container.

Examples
- Local one-off (with Node installed):
  npx prisma migrate deploy --schema=dev/backend/prisma/schema.prisma
- CI job (Node 20 runner):
  - checkout repo
  - install pnpm/npm
  - npm ci --workspace dev/backend
  - npx prisma generate --schema dev/backend/prisma/schema.prisma
  - DATABASE_URL=${PROD_DATABASE_URL} npx prisma migrate deploy --schema dev/backend/prisma/schema.prisma

5) Configure frontend to use the production API
- Set NEXT_PUBLIC_API_URL=https://api.yourdomain.com in the frontend env (Vercel project env or .env.production if self-hosting).
- Allow this origin in backend CORS_ORIGIN.

6) Secrets and environment
- Backend: DATABASE_URL, REDIS_URL, JWT_SECRET, JWT_REFRESH_SECRET, STRIPE_SECRET_KEY/WEBHOOK_SECRET (if using billing), SMTP creds, AI provider keys as needed.
- Frontend: only safe public values (NEXT_PUBLIC_*). Do not expose secrets.
- Rotations: set up a rotation cadence for JWT and API keys.

7) Networking, TLS, and domains
- Put the backend behind an HTTPS terminator (ALB/NGINX/Traefik) on api.yourdomain.com.
- TLS certs from Let’s Encrypt or ACM.
- If self-hosting Compose: add an nginx reverse proxy container or terminate TLS at the host and forward to :4000.

8) Observability and reliability
- Logs: forward stdout/stderr to your logging stack (CloudWatch, Datadog, ELK, or Render/Railway built-ins).
- Error tracking: add Sentry DSN to backend (and frontend); initialize early in main.ts.
- Metrics: set alerts for CPU/memory, Postgres connections, slow queries, Redis memory/latency.
- Backups: ensure Postgres automated backups + tested restore; snapshot Redis if it’s a persistence tier.

9) Operational runbook
- Deployment order: run migrations → roll out backend → verify health → switch traffic.
- Rollback plan: keep previous image, reversible migrations strategy if needed.
- Access control: restrict DB and Redis by VPC/IP allow-lists.

Quick command summary (self-hosted Compose)
- Build backend image:
  cd dev/backend && docker build -t answly-backend:prod -f Dockerfile .
- Run migrations from CI (recommended) or locally with Node:
  DATABASE_URL="postgresql://..." npx prisma migrate deploy --schema=dev/backend/prisma/schema.prisma
- Bring up backend:
  cd dev && docker compose -f docker-compose.prod.yml up -d --build

Safeguards
- Replace hard-coded dev secrets; set strong JWT secrets.
- Set NODE_ENV=production.
- Set CSP to your domains if you tighten Helmet later.
- Verify Stripe webhook signature handling (rawBody already enabled).

Want me to add the production Dockerfiles and a docker-compose.prod.yml to the repo, plus a short PROD.md with these steps? I can generate and place them in dev/backend, dev/frontend, and dev/.